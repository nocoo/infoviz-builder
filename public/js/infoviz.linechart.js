define(function(b,a,c){b.async(["infoviz.core"],function(d){a.draw_linechart=function(g,v,ad,J,U,S){if(!g||!ad){return idb("Paper or Data is empty.")}var F=d.merge_options(J),w=[],V,T;var P=ad.data,B=[],G=[],ac,ab,aa,M;var I=ad.horizontal_field,h=ad.vertical_field;var m,ae,H=Infinity,ag=-Infinity,Q=Infinity,r=-Infinity;for(var t in P){for(ac=0;ac<P[t]["data"].length;++ac){M=P[t]["data"][ac];if(M[I]!==undefined){m=M[I]}else{m="N/A"}if(m>ag){ag=m}if(m<H){H=m}if(d.in_array(m,B)===-1){B.push(m)}if(d.isNumber(M[h])){ae=M[h]}else{ae="N/A"}if(ae>r){r=ae}if(ae<Q){Q=ae}if(d.in_array(ae,G)===-1){G.push(ae)}}}Q=Math.floor(Q/10)*10;r=Math.ceil(r/10)*10;var X=v["top-left"][0]+F.linechart["padding-left"];var E=(v["top-right"][0]-F.linechart["padding-right"]-X)/(B.length-1);var Z=v["bottom-left"][1]-F.linechart["padding-bottom"];var R=(Z-v["top-left"][1]-F.linechart["padding-top"])/(r-Q);var l={};var z=(Z-v["top-left"][1]-F.linechart["padding-top"])/(F.linechart["vertical-label-count"]-1);var q=Math.floor((r-Q)/(F.linechart["vertical-label-count"]-1));w=[];V=v["top-left"][0]-F.linechart["vertical-bar-width"];T=Z;var n=Q;for(ac=0;ac<F.linechart["vertical-label-count"];++ac){w.push("M"+V+","+T+"L"+v["top-left"][0]+","+T);g.path(w.join("")).attr({stroke:F.grid["axis-color"],"stroke-opacity":F.grid["axis-alpha"],"stroke-width":F.grid["axis-width"]}).translate(0.5,0.5);g.text(V-F.linechart["vertical-bar-width"],T,n).attr({"text-anchor":"end",fill:F.grid["vertical-label-color"],"font-size":F.grid["vertical-label-size"]}).translate(0.5,0.5);T-=z;n+=q}var s;w=[];V=X;T=v["bottom-right"][1]+F.grid["horizontal-name-size"]/2+F.grid["horizontal-label-margin"]*2;for(ac=0;ac<B.length;++ac){w.push("M"+V+","+v["bottom-left"][1]);w.push("L"+V+","+v["top-left"][1]);l[B[ac]]=V;g.text(V,T,B[ac]).attr({"text-anchor":"middle","font-size":F.grid["horizontal-label-size"],fill:F.grid["horizontal-label-color"]}).translate(0.5,0.5);V+=E}s=g.path(w.join(""));s.attr({stroke:F.grid["grid-color"],"stroke-dasharray":"--..","stroke-linecap":"butt","stroke-width":F.grid["grid-width"],"stroke-opacity":F.grid["grid-alpha"]});s.translate(0.5,0.5);var O=0,K;var W=[],f=[];for(var t in P){var e,A,o,C,af=[];var D,L;w=[];K=F.color[(O%F.color.length)];for(ac=0;ac<P[t]["data"].length;++ac){M=P[t]["data"][ac];V=l[M[I]];T=Z-(M[h]-Q)*R+F.linechart["circle-radius"];if(ac===0){w.push("M"+V+","+T);D=V}else{w.push("L"+V+","+T)}if(ac===P[t]["data"].length-1){L=V}af.push({x:V,y:T,v_value:M[h],h_value:M[I],data:M})}e=g.path(w.join("")).attr({stroke:K.color,"stroke-opacity":K["light-alpha"],"stroke-width":F.linechart["line-width"]}).translate(0.5,0.5);o=g.text(V+F.linechart["circle-radius"]*2,T,P[t]["name"]).attr({fill:K.color,"text-anchor":"start","font-size":F.linechart["label-size"]}).translate(0.5,0.5);if(F.linechart["area-enabled"]){w.push("L"+L+","+v["bottom-left"][1]);w.push("L"+D+","+v["bottom-left"][1]);w.push("Z");C=g.path(w.join("")).attr({stroke:"none",fill:K.color,"fill-opacity":F.linechart["area-alpha"]}).translate(0.5,0.5)}for(ac=0;ac<af.length;++ac){if(F.linechart["custom-circle"]){A=g.image(F.linechart["custom-circle"],af[ac]["x"]-F.linechart["circle-radius"],af[ac]["y"]-F.linechart["circle-radius"],F.linechart["circle-radius"]*2,F.linechart["circle-radius"]*2).attr({cursor:"pointer"}).translate(0.5,0.5)}else{A=g.circle(af[ac]["x"],af[ac]["y"],F.linechart["circle-radius"]).attr({stroke:K.color,"stroke-opacity":K["dark-alpha"],"stroke-width":F.linechart["line-width"],fill:K.color}).translate(0.5,0.5)}f.push(A);if(U&&typeof(U)==="function"){A.data("info",{data:af[ac]["data"],x:af[ac]["x"],y:af[ac]["y"],v_value:af[ac]["v_value"],h_value:af[ac]["h_value"],that:S,callback:U});A.click(d.element_action)}if(ad.tooltip_title||ad.tooltip_content){var N=ad.tooltip_title;var u=ad.tooltip_content;for(var Y in af[ac]["data"]){N=N.replace("{"+Y+"}",af[ac]["data"][Y]);u=u.replace("{"+Y+"}",af[ac]["data"][Y])}A.data("tooltip",{id:t+ac,title:N,content:u,color:K,x:af[ac]["x"],y:af[ac]["y"],element:A,options:F,paper:g});A.hover(d.element_tooltip)}}if(F.linechart["area-enabled"]){W.push({label:P[t]["name"],color:K,type:"area"})}else{W.push({label:P[t]["name"],color:K,type:"line"})}O++}for(ac=0;ac<f.length;++ac){f[ac].toFront()}d.draw_legend(g,v,W,F)}})});